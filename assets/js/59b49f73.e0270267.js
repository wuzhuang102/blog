"use strict";(self.webpackChunkwz_blog=self.webpackChunkwz_blog||[]).push([[4765],{9613:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return u}});var r=t(9496);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=r.createContext({}),d=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},p=function(e){var n=d(e.components);return r.createElement(s.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),m=d(t),u=a,k=m["".concat(s,".").concat(u)]||m[u]||c[u]||o;return t?r.createElement(k,l(l({ref:n},p),{},{components:t})):r.createElement(k,l({ref:n},p))}));function u(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,l=new Array(o);l[0]=m;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var d=2;d<o;d++)l[d]=t[d];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},4551:function(e,n,t){t.r(n),t.d(n,{assets:function(){return p},contentTitle:function(){return s},default:function(){return u},frontMatter:function(){return i},metadata:function(){return d},toc:function(){return c}});var r=t(2182),a=t(9028),o=(t(9496),t(9613)),l=["components"],i={},s="\u6e90\u7801\u7bc7 --- Vue2 \u6e90\u7801\u89e3\u6790",d={unversionedId:"javascript/framework/vue2",id:"javascript/framework/vue2",title:"\u6e90\u7801\u7bc7 --- Vue2 \u6e90\u7801\u89e3\u6790",description:"\u672c\u6587\u76f8\u5173\u6e90\u7801\u7684\u6ce8\u91ca --- Vue2.x \u6e90\u7801\u6ce8\u91ca",source:"@site/packages/docs/javascript/framework/vue2.md",sourceDirName:"javascript/framework",slug:"/javascript/framework/vue2",permalink:"/blog/docs/javascript/framework/vue2",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Typescript",permalink:"/blog/docs/javascript/typescript"},next:{title:"\u6e90\u7801\u7bc7 --- Vue3 \u6e90\u7801\u89e3\u6790",permalink:"/blog/docs/javascript/framework/vue3"}},p={},c=[{value:"1. Vue \u6e90\u7801\u6574\u4f53\u6d41\u7a0b",id:"1-vue-\u6e90\u7801\u6574\u4f53\u6d41\u7a0b",level:2},{value:"2. Vue \u6a21\u5757\u8be6\u89e3",id:"2-vue-\u6a21\u5757\u8be6\u89e3",level:2},{value:"1. observer \u6a21\u5757",id:"1-observer-\u6a21\u5757",level:3},{value:"1. observer \u6a21\u5757\u6838\u5fc3\u90e8\u5206",id:"1-observer-\u6a21\u5757\u6838\u5fc3\u90e8\u5206",level:4},{value:"2. \u4f9d\u8d56\u6536\u96c6",id:"2-\u4f9d\u8d56\u6536\u96c6",level:4},{value:"\u4f9d\u8d56\u6536\u96c6\u8fc7\u7a0b",id:"\u4f9d\u8d56\u6536\u96c6\u8fc7\u7a0b",level:5},{value:"3. \u4ee3\u7801\u90e8\u5206",id:"3-\u4ee3\u7801\u90e8\u5206",level:4},{value:"2. instance \u6a21\u5757",id:"2-instance-\u6a21\u5757",level:3},{value:"\u4ee3\u7801\u90e8\u5206",id:"\u4ee3\u7801\u90e8\u5206",level:4},{value:"3. vdom \u6a21\u5757",id:"3-vdom-\u6a21\u5757",level:3},{value:"\u4ee3\u7801\u90e8\u5206",id:"\u4ee3\u7801\u90e8\u5206-1",level:4},{value:"1. vnode.js",id:"1-vnodejs",level:5},{value:"2. create-component.js",id:"2-create-componentjs",level:5},{value:"3. create-element.js",id:"3-create-elementjs",level:5},{value:"4. create-functional-component.js",id:"4-create-functional-componentjs",level:5},{value:"5. patch.js",id:"5-patchjs",level:5},{value:"4. compiler \u6a21\u5757",id:"4-compiler-\u6a21\u5757",level:3},{value:"\u4ee3\u7801\u90e8\u5206",id:"\u4ee3\u7801\u90e8\u5206-2",level:4},{value:"1. codegen/*.js",id:"1-codegenjs",level:5},{value:"2. directives/*.js",id:"2-directivesjs",level:5},{value:"3. parser/*.js",id:"3-parserjs",level:5},{value:"3. Vue \u7ec4\u4ef6",id:"3-vue-\u7ec4\u4ef6",level:2},{value:"1. keep-alive",id:"1-keep-alive",level:3},{value:"4. Vue \u5de5\u5177\u51fd\u6570",id:"4-vue-\u5de5\u5177\u51fd\u6570",level:2},{value:"1. nextTick()",id:"1-nexttick",level:3},{value:"Vue \u6e90\u7801\u76ee\u5f55",id:"vue-\u6e90\u7801\u76ee\u5f55",level:2},{value:"\u535a\u6587\u53c2\u8003",id:"\u535a\u6587\u53c2\u8003",level:4}],m={toc:c};function u(e){var n=e.components,i=(0,a.Z)(e,l);return(0,o.kt)("wrapper",(0,r.Z)({},m,i,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"\u6e90\u7801\u7bc7-----vue2-\u6e90\u7801\u89e3\u6790"},"\u6e90\u7801\u7bc7 --- Vue2 \u6e90\u7801\u89e3\u6790"),(0,o.kt)("p",null,"\u672c\u6587\u76f8\u5173\u6e90\u7801\u7684\u6ce8\u91ca --- ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wuzhuang102/blog/tree/source-code/vue-dev/"},"Vue2.x \u6e90\u7801\u6ce8\u91ca")),(0,o.kt)("h2",{id:"1-vue-\u6e90\u7801\u6574\u4f53\u6d41\u7a0b"},"1. Vue \u6e90\u7801\u6574\u4f53\u6d41\u7a0b"),(0,o.kt)("h2",{id:"2-vue-\u6a21\u5757\u8be6\u89e3"},"2. Vue \u6a21\u5757\u8be6\u89e3"),(0,o.kt)("h3",{id:"1-observer-\u6a21\u5757"},"1. observer \u6a21\u5757"),(0,o.kt)("p",null,"\u666e\u901a\u7684 JavaScript \u5bf9\u8c61\u4f20\u5165 Vue \u5b9e\u4f8b\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"data"),"\u65f6\uff0cVue \u5c06\u904d\u5386\u5bf9\u8c61\u7684\u6240\u6709 property\uff0c\u5e76\u4f7f\u7528",(0,o.kt)("inlineCode",{parentName:"p"},"Object.defineProperty"),"\u5c06\u5c5e\u6027\u5168\u90e8\u8f6c\u4e3a",(0,o.kt)("inlineCode",{parentName:"p"},"getter/setter"),"\uff0c\u8fd9\u662f IE8 \u53ca\u4ee5\u4e0b\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u7684\u4e00\u4e2a\u5c5e\u6027"),(0,o.kt)("h4",{id:"1-observer-\u6a21\u5757\u6838\u5fc3\u90e8\u5206"},"1. observer \u6a21\u5757\u6838\u5fc3\u90e8\u5206"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},(0,o.kt)("a",{parentName:"strong",href:"https://github.com/vuejs/vue/blob/v2.1.10/src/core/observer/index.js#L39-L53"},"Observer")),"\uff1a\u6570\u636e\u7684\u89c2\u5bdf\u8005\uff0c\u8ba9\u6570\u636e\u5bf9\u8c61\u7684\u8bfb\u5199\u64cd\u4f5c\u90fd\u5904\u4e8e\u76d1\u7763\u4e4b\u4e0b"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},(0,o.kt)("a",{parentName:"strong",href:"https://github.com/vuejs/vue/blob/dev/src/core/observer/watcher.js#L45-L96"},"Watcher")),"\uff1a\u6570\u636e\u7684\u8ba2\u9605\u8005\uff0c\u6570\u636e\u7684\u53d8\u5316\u4f1a\u901a\u77e5\u5230 Watcher \u7136\u540e\u8fdb\u884c\u76f8\u5e94\u7684\u64cd\u4f5c\uff0c\u4f8b\u5982\u66f4\u65b0\u89c6\u56fe"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},(0,o.kt)("a",{parentName:"strong",href:"https://github.com/vuejs/vue/blob/dev/src/core/observer/dep.js#L18-L21"},"Dep")),"\uff1aObserver \u4e0e Watcher \u7684\u7ebd\u5e26\uff0c\u6570\u636e\u53d8\u5316\u65f6\uff0c\u88ab Observer \u89c2\u5bdf\u5230\uff0c\u7136\u540e\u7531 Dep \u901a\u77e5\u5230 Watcher")),(0,o.kt)("h4",{id:"2-\u4f9d\u8d56\u6536\u96c6"},"2. \u4f9d\u8d56\u6536\u96c6"),(0,o.kt)("p",null,"\u4f9d\u8d56\u6536\u96c6\u662f\u901a\u8fc7\u5c5e\u6027\u7684 getter \u51fd\u6570\u5b8c\u6210\u7684\uff0c Observer \u4e0e Dep \u662f\u4e00\u5bf9\u4e00\u7684\u5173\u7cfb\uff0c Dep \u4e0e Watcher \u662f\u591a\u5bf9\u591a\u7684\u5173\u7cfb\u3002\u4f9d\u8d56\u6536\u96c6\u5b8c\u6210\u540e\uff0c\u5f53\u5c5e\u6027\u53d8\u5316\u4f1a\u6267\u884c Observer \u7684 dep.notify\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u904d\u5386\u8ba2\u9605\u8005\u5217\u8868\u5411\u5176\u53d1\u9001\u6d88\u606f\uff0cWatcher \u6267\u884c run \u65b9\u6cd5\u53bb\u66f4\u65b0\u89c6\u56fe\uff08\u89c1\u4e0b\u56fe\uff09\n",(0,o.kt)("img",{src:t(5757).Z,width:"856",height:"449"})),(0,o.kt)("h5",{id:"\u4f9d\u8d56\u6536\u96c6\u8fc7\u7a0b"},"\u4f9d\u8d56\u6536\u96c6\u8fc7\u7a0b"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u521d\u59cb\u5316\u72b6\u6001 ",(0,o.kt)("inlineCode",{parentName:"li"},"initState"),"\uff0c\u671f\u95f4\u901a\u8fc7 ",(0,o.kt)("inlineCode",{parentName:"li"},"defineReactive")," \u5c06\u6570\u636e\u53d8\u6210\u54cd\u5e94\u5f0f\u5bf9\u8c61\uff0c\u5176\u4e2d ",(0,o.kt)("inlineCode",{parentName:"li"},"getter")," \u90e8\u5206\u7528\u6765\u6536\u96c6\u4f9d\u8d56"),(0,o.kt)("li",{parentName:"ol"},"\u521d\u59cb\u5316\u81f3 ",(0,o.kt)("inlineCode",{parentName:"li"},"mounted")," \u8fc7\u7a0b\uff0c\u4f1a\u5b9e\u4f8b\u5316 ",(0,o.kt)("inlineCode",{parentName:"li"},"Watcher")," \uff0c\u5c31\u4f1a\u6267\u884c ",(0,o.kt)("inlineCode",{parentName:"li"},"get")," \u65b9\u6cd5\uff0c\u8c03\u7528 ",(0,o.kt)("inlineCode",{parentName:"li"},"pushTarget()")," \uff0c\u5c06 ",(0,o.kt)("inlineCode",{parentName:"li"},"Dep.target")," \u6307\u5411\u5f53\u524d\u7684 ",(0,o.kt)("inlineCode",{parentName:"li"},"Watcher")),(0,o.kt)("li",{parentName:"ol"},"\u6bcf\u4e2a\u5bf9\u8c61\u7684 ",(0,o.kt)("inlineCode",{parentName:"li"},"getter")," \u90fd\u6709\u4e00\u4e2a ",(0,o.kt)("inlineCode",{parentName:"li"},"dep"),"\uff0c",(0,o.kt)("inlineCode",{parentName:"li"},"getter")," \u89e6\u53d1\u65f6\u4e5f\u4f1a\u8c03\u7528 ",(0,o.kt)("inlineCode",{parentName:"li"},"dep.depend()"),"\uff0c\u6267\u884c",(0,o.kt)("inlineCode",{parentName:"li"},"Dep.taregt.addDep(this)")," --\x3e ",(0,o.kt)("inlineCode",{parentName:"li"},"dep.addSubs(this)"),"\uff0c \u5c06\u5f53\u524d ",(0,o.kt)("inlineCode",{parentName:"li"},"Watcher")," \u6dfb\u52a0\u5230 dep \u4e2d",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Watcher")," \u7684\u79cd\u7c7b",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"render watcher")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"computed watcher")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"watch watcher"))))))),(0,o.kt)("p",null,(0,o.kt)("img",{src:t(7889).Z,width:"648",height:"720"})),(0,o.kt)("h4",{id:"3-\u4ee3\u7801\u90e8\u5206"},"3. \u4ee3\u7801\u90e8\u5206"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"src/core/observer/\n\u251c\u2500\u2500 array.js\n\u251c\u2500\u2500 dep.js\n\u251c\u2500\u2500 index.js\n\u251c\u2500\u2500 scheduler.js\n\u251c\u2500\u2500 traverse.js\n\u2514\u2500\u2500 watcher.js\n")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"array.js"),"\n\u7531\u4e8e JavaScript \u7684\u9650\u5236\uff0c Vue \u4e0d\u80fd\u68c0\u6d4b\u6570\u7ec4\u7684\u53d8\u5316\uff0c\u4e8e\u662f\u4f5c\u8005\u5728\u6570\u7ec4\u589e\u5f3a\u65b9\u6cd5\u4e2d\u5bf9 Array \u7684 \u2018push\u2019, \u2018pop\u2019, \u2018shift\u2019, \u2018unshift\u2019, \u2018splice\u2019, \u2018sort\u2019, \u2018reverse\u2019 \u65b9\u6cd5\u505a\u4e86\u589e\u5f3a\u5b9e\u73b0\uff0c\u5177\u4f53\u5b9e\u73b0\u53ef\u4ee5\u770b\u6e90\u7801 ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/vuejs/vue/blob/dev/src/core/observer/array.js"},(0,o.kt)("inlineCode",{parentName:"a"},"/src/core/observer/array.js"))," \uff0c\u8fd9\u4e5f\u662f Vue.js \u4e2d\u6570\u7ec4\u64cd\u4f5c\u53ea\u80fd\u4f7f\u7528\u8fd9\u51e0\u4e2a\u65b9\u6cd5\u7684\u539f\u56e0\u3002"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"dep.js"),"\n\u4e00\u4e2a Observer \u5b9e\u4f8b\u5bf9\u5e94\u4e00\u4e2a Dep \u5b9e\u4f8b\uff0c\u8fd9\u4e2a Dep \u5b9e\u4f8b\u5b58\u51fa\u591a\u4e2a\u76f8\u5173\u7684 Watcher \u5b9e\u4f8b\uff0cObserver \u53d1\u73b0\u6570\u636e\u53d8\u66f4\u65f6\uff0c\u7531 Dep \u901a\u77e5\u5404\u4e2a\u8ba2\u9605\u6570\u636e\u7684 Watcher"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"index.js (Observer)"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"\u9996\u5148\u521b\u5efa\u4e00\u4e2a Dep \u5bf9\u8c61\u5b9e\u4f8b"),(0,o.kt)("li",{parentName:"ul"},"\u628a\u81ea\u8eab this \u6dfb\u52a0\u5230 value \u7684 ","_","_","ob","_","_"," \u5c5e\u6027\u4e0a"),(0,o.kt)("li",{parentName:"ul"},"\u6700\u540e\u5bf9 value \u8fdb\u884c\u7c7b\u578b\u5224\u65ad\uff0c\u5982\u679c\u662f\u6570\u7ec4\u5c31\u89c2\u5bdf\u6570\u7ec4\uff08\u6570\u7ec4\u4f7f\u7528 array.js \u91cd\u5199\u7684\u65b9\u6cd5\uff09\uff0c\u5426\u5219\u89c2\u5bdf\u5355\u4e2a\u5143\u7d20\uff08\u8fd9\u662f\u4e00\u4e2a\u9012\u5f52\u7684\u8fc7\u7a0b\uff09")))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"observeArray"),"\u5bf9\u6570\u7ec4\u8fdb\u884c\u904d\u5386\uff0c\u9012\u5f52\u8c03\u7528",(0,o.kt)("strong",{parentName:"p"},"obeserve"),"\u65b9\u6cd5\uff0c\u6700\u7ec8\u8c03\u7528",(0,o.kt)("strong",{parentName:"p"},"walk"),"\u65b9\u6cd5\uff0cwalk \u65b9\u6cd5\u9012\u5f52\u8c03\u7528 ",(0,o.kt)("strong",{parentName:"p"},"defineReactive")," \u5c06\u5c5e\u6027\u503c\u8f6c\u5316\u4e3a getter/setter"),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"scheduler.js")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"traverse.js")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"watcher.js"))),(0,o.kt)("h3",{id:"2-instance-\u6a21\u5757"},"2. instance \u6a21\u5757"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"src/core/instance")," \u4e2d\u7684\u4ee3\u7801\u662f\u4ee3\u7801\u5728 new Vue \u53d1\u751f\u7684\u4e00\u7cfb\u5217\u64cd\u4f5c\uff0cinitLifecyle\u3001initEvents\u3001initRender\u3001initInjections\u3001initState\u3001initProvide"),(0,o.kt)("h4",{id:"\u4ee3\u7801\u90e8\u5206"},"\u4ee3\u7801\u90e8\u5206"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\u251c\u2500\u2500 render-helpers/\n\u251c\u2500\u2500 events.js\n\u251c\u2500\u2500 index.js\n\u251c\u2500\u2500 init.js\n\u251c\u2500\u2500 inject.js\n\u251c\u2500\u2500 lifecycle.js\n\u251c\u2500\u2500 proxy.js\n\u251c\u2500\u2500 render.js\n\u2514\u2500\u2500 state.js\n")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"index.js"),"\uff1a\u5165\u53e3\u6587\u4ef6\uff0cVue \u51fd\u6570\u5c31\u5728\u8fd9\u91cc"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"init.js"),"\uff1a",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"\u521d\u59cb\u5316\u6587\u4ef6\uff0c\u6bcf\u4e2a new Vue \u7684\u5b9e\u4f8b\u90fd\u4f1a\u6267\u884c init.js \u4e2d\u7684 ","_","init() \u51fd\u6570\u6765\u521d\u59cb\u5316\uff0c\u4e0b\u9762\u5c31\u662f ","_","init()\u4e2d\u7684\u4e00\u6bb5\u4ee3\u7801")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},"initLifecycle(vm);\ninitEvents(vm);\ninitRender(vm);\ncallHook(vm, 'beforeCreate');\ninitInjections(vm); // resolve injections before data/props\ninitState(vm);\ninitProvide(vm); // resolve provide after data/props\ncallHook(vm, 'created');\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"lifecycle.js"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"\u5b9a\u4e49\u5b9e\u4f8b\u7684\u751f\u547d\u5468\u65b9\u6cd5\uff1a$forceUpdate\u3001$destroy"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"event.js"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"\u5b9a\u4e49\u5b9e\u4f8b\u7684\u65b9\u6cd5\uff1a$on\u3001$once\u3001$off\u3001$emit"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"render.js"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"render.js \u4e2d\u7684 ","_","render \u8d1f\u8d23\u628a\u5b9e\u4f8b\u6e32\u67d3\u6210\u865a\u62df Node"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"inject.js")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"state.js"))),(0,o.kt)("h3",{id:"3-vdom-\u6a21\u5757"},"3. vdom \u6a21\u5757"),(0,o.kt)("h4",{id:"\u4ee3\u7801\u90e8\u5206-1"},"\u4ee3\u7801\u90e8\u5206"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\u251c\u2500\u2500 create-component.js\n\u251c\u2500\u2500 create-element.js\n\u251c\u2500\u2500 create-functional-component.js\n\u251c\u2500\u2500 helpers\n\u2502   \u251c\u2500\u2500 extract-props.js\n\u2502   \u251c\u2500\u2500 get-first-component-child.js\n\u2502   \u251c\u2500\u2500 index.js\n\u2502   \u251c\u2500\u2500 is-async-placeholder.js\n\u2502   \u251c\u2500\u2500 merge-hook.js\n\u2502   \u251c\u2500\u2500 normalize-children.js\n\u2502   \u251c\u2500\u2500 normalize-scoped-slots.js\n\u2502   \u251c\u2500\u2500 resolve-async-component.js\n\u2502   \u2514\u2500\u2500 update-listeners.js\n\u251c\u2500\u2500 modules\n\u2502   \u251c\u2500\u2500 directives.js\n\u2502   \u251c\u2500\u2500 index.js\n\u2502   \u2514\u2500\u2500 ref.js\n\u251c\u2500\u2500 patch.js\n\u2514\u2500\u2500 vnode.js\n")),(0,o.kt)("h5",{id:"1-vnodejs"},"1. vnode.js"),(0,o.kt)("p",null,"\u5b9a\u4e49 VNode \u7c7b\uff0c\u548c\u4e00\u4e9b\u521b\u5efa VNode \u7684\u65b9\u6cd5"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"export default class VNode {\n  /* ... */\n}\nexport const createEmptyVNode = (text: string = '') => {\n  /*...*/\n};\nexport function createTextVNode(val: string | number) {\n  /*...*/\n}\nexport function cloneVNode(vnode: VNode): VNode {\n  /*...*/\n}\n")),(0,o.kt)("h5",{id:"2-create-componentjs"},"2. create-component.js"),(0,o.kt)("h5",{id:"3-create-elementjs"},"3. create-element.js"),(0,o.kt)("h5",{id:"4-create-functional-componentjs"},"4. create-functional-component.js"),(0,o.kt)("h5",{id:"5-patchjs"},"5. patch.js"),(0,o.kt)("p",null,"patch.js \u4e2d\u5b58\u653e\u7740 DOM Diff \u7684\u6838\u5fc3\u4ee3\u7801\uff0c\u4e3b\u8981\u601d\u60f3\u5c31\u662f\u5faa\u73af\u5224\u65ad\uff0c\u5224\u65ad\u6bcf\u4e2a\u66f4\u65b0\u7684 vnode \u7684\u4fee\u6539\u60c5\u51b5"),(0,o.kt)("p",null,"\u8fd9\u91cc\u53ea\u662f\u5224\u65ad vnode \u4fee\u6539\u7684\u5177\u4f53\u60c5\u51b5\uff0c\u4fee\u6539\u771f\u5b9e DOM \u7684\u4ee3\u7801\u5728 ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wuzhuang102/blog/blob/source-code/vue-dev/src/platforms/web/runtime/node-ops.js"},"/platforms/","*","/runtime/node-ops.js"),"\uff0c\u5b9e\u73b0\u4e86\u4e00\u4e9b\u8de8\u5e73\u53f0\u7684\u5c01\u88c5"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"patch()"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"\u5224\u65ad\u4e24\u4e2a\u8282\u70b9\u662f\u5426\u503c\u5f97\u6bd4\u8f83(",(0,o.kt)("inlineCode",{parentName:"li"},"sameVnode()"),")\uff0c\u503c\u5f97\u6bd4\u8f83\u5c31\u6267\u884c ",(0,o.kt)("inlineCode",{parentName:"li"},"patchVnode()")),(0,o.kt)("li",{parentName:"ul"},"\u4e0d\u503c\u5f97\u6bd4\u8f83\u5c31\u7528 ",(0,o.kt)("inlineCode",{parentName:"li"},"Vnode")," \u66ff\u6362 ",(0,o.kt)("inlineCode",{parentName:"li"},"oldVnode"))),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},"if (isUndef(oldVnode)) {\n  // oldVnode \u672a\u5b9a\u4e49\u7684\u65f6\u5019\uff0c\u4e5f\u5c31\u662f root \u8282\u70b9\uff0c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u8282\u70b9\n  isInitialPatch = true;\n  createElm(vnode, insertedVnodeQueue);\n} else {\n  // oldVnode \u662f\u5426\u6709 nodeType\uff0c\u662f\u5426\u662f\u771f\u5b9e element\n  const isRealElement = isDef(oldVnode.nodeType);\n  if (!isRealElement && sameVnode(oldVnode, vnode)) {\n    // patch existing root node\n    // \u662f\u540c\u4e00\u4e2a\u8282\u70b9\u5c31\u8fdb\u884c patchVnode\n    patchVnode(oldVnode, vnode, insertedVnodeQueue, null, null, removeOnly);\n  } else {\n    // ...\n    // \u66ff\u4ee3\u73b0\u6709\u8282\u70b9\n    const oldElm = oldVnode.elm;\n    const parentElm = nodeOps.parentNode(oldElm);\n    createElm(vnode, insertedVnodeQueue, oldElm._leaveCb ? null : parentElm, nodeOps.nextSibling(oldElm));\n    // \u904d\u5386\u66f4\u65b0\u7ec4\u4ef6\u6839\u8282\u70b9\uff0c\u5305\u542b destroy \u548c create \u58f0\u660e\u5468\u671f\n    if (isDef(vnode.parent)) {\n    }\n    if (isDef(parentElm)) {\n      removeVnodes([oldVnode], 0, 0);\n    } else if (isDef(oldVnode.tag)) {\n      invokeDestroyHook(oldVnode);\n    }\n  }\n}\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"sameVnode()"),"\uff1asameVnode \u7684\u5224\u65ad\u4f9d\u636e",(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function sameVnode(a, b) {\n  return (\n    a.key === b.key &&\n    a.tag === b.tag &&\n    a.isComment === b.isComment &&\n    isDef(a.data) === isDef(b.data) &&\n    sameInputType(a, b)\n  );\n}\nfunction sameInputType(a, b) {\n  if (a.tag !== 'input') return true;\n  let i;\n  const typeA = isDef((i = a.data)) && isDef((i = i.attrs)) && i.type;\n  const typeB = isDef((i = b.data)) && isDef((i = i.attrs)) && i.type;\n  return typeA === typeB;\n}\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"patchVnode()"),"\uff1a",(0,o.kt)("inlineCode",{parentName:"li"},"sameVnode"),"\u7684\u8282\u70b9\u9700\u8981\u8fdb\u884c\u6df1\u5c42\u6b21\u7684 patch",(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function patchVnode() {\n  const oldCh = oldVnode.children;\n  const ch = vnode.children;\n  if (isDef(data) && isPatchable(vnode)) {\n    for (i = 0; i < cbs.update.length; ++i) cbs.update[i](oldVnode, vnode);\n    if (isDef((i = data.hook)) && isDef((i = i.update))) i(oldVnode, vnode);\n  }\n  // 1. \u5982\u679c\u65b0 vnode \u6ca1\u6709 text \u6587\u672c\u65f6\n  if (isUndef(vnode.text)) {\n    // 1.1 \u65b0\u8001 vnode \u90fd\u6709 children \u8282\u70b9\u65f6\uff0c\u5219\u5bf9\u5b50\u8282\u70b9\u8fdb\u884c diff\uff0cupdateChildren\n    if (isDef(oldCh) && isDef(ch)) {\n      if (oldCh !== ch) updateChildren(elm, oldCh, ch, insertedVnodeQueue, removeOnly);\n      // 1.2 oldVnode \u6ca1\u6709\u5b50\u8282\u70b9\uff0c\u65b0\u7684vnode\u6709\u5b50\u8282\u70b9\uff0c\u5148\u6e05\u7a7a\u6587\u672c\uff0c\u518d\u6dfb\u52a0\u5b50\u8282\u70b9\n    } else if (isDef(ch)) {\n      if (process.env.NODE_ENV !== 'production') {\n        checkDuplicateKeys(ch);\n      }\n      if (isDef(oldVnode.text)) nodeOps.setTextContent(elm, '');\n      addVnodes(elm, null, ch, 0, ch.length - 1, insertedVnodeQueue);\n      // 1.3 oldVnode \u6709\u5b50\u8282\u70b9\uff0c\u65b0 vnode \u6ca1\u6709\u5b50\u8282\u70b9\uff0c\u6e05\u7a7a\u5b50\u8282\u70b9\n    } else if (isDef(oldCh)) {\n      removeVnodes(oldCh, 0, oldCh.length - 1);\n      // 1.4 \u90fd\u6ca1\u6709\u5b50\u8282\u70b9\uff0c\u5c31\u8fdb\u884c\u6587\u672c\u66ff\u6362\n    } else if (isDef(oldVnode.text)) {\n      nodeOps.setTextContent(elm, '');\n    }\n    // 2. \u6587\u672c\u66ff\u6362\n  } else if (oldVnode.text !== vnode.text) {\n    nodeOps.setTextContent(elm, vnode.text);\n  }\n  // \u8c03\u7528postpatch\u94a9\u5b50\n  if (isDef(data)) {\n    if (isDef((i = data.hook)) && isDef((i = i.postpatch))) i(oldVnode, vnode);\n  }\n}\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"updateChildren()"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function updateChildren() {\n  while (oldStartIdx <= oldEndIdx && newStartIdx <= newEndIdx) {\n    if (isUndef(oldStartVnode)) {\n      oldStartVnode = oldCh[++oldStartIdx]; // Vnode has been moved left\n    } else if (isUndef(oldEndVnode)) {\n      oldEndVnode = oldCh[--oldEndIdx];\n      // \u56db\u79cdkey\u76f8\u540c\u7684\u60c5\u51b5\uff0c\u76f4\u63a5\u8fdb\u884cpatchVnode\u73af\u8282\uff0c\u540e\u4e24\u79cd\u60c5\u51b5\u9700\u8981\u79fb\u52a8\u771f\u5b9e DOM \u7684\u4f4d\u7f6e\n    } else if (sameVnode(oldStartVnode, newStartVnode)) {\n      patchVnode(oldStartVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx);\n      oldStartVnode = oldCh[++oldStartIdx];\n      newStartVnode = newCh[++newStartIdx];\n    } else if (sameVnode(oldEndVnode, newEndVnode)) {\n      patchVnode(oldEndVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx);\n      oldEndVnode = oldCh[--oldEndIdx];\n      newEndVnode = newCh[--newEndIdx];\n    } else if (sameVnode(oldStartVnode, newEndVnode)) {\n      // Vnode moved right\n      patchVnode(oldStartVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx);\n      canMove && nodeOps.insertBefore(parentElm, oldStartVnode.elm, nodeOps.nextSibling(oldEndVnode.elm));\n      oldStartVnode = oldCh[++oldStartIdx];\n      newEndVnode = newCh[--newEndIdx];\n    } else if (sameVnode(oldEndVnode, newStartVnode)) {\n      // Vnode moved left\n      patchVnode(oldEndVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx);\n      canMove && nodeOps.insertBefore(parentElm, oldEndVnode.elm, oldStartVnode.elm);\n      oldEndVnode = oldCh[--oldEndIdx];\n      newStartVnode = newCh[++newStartIdx];\n    } else {\n      // \u751f\u6210odlChildren\u7684 key \u4e0e index \u5bf9\u5e94\u7684\u54c8\u5e0c\u8868\n      if (isUndef(oldKeyToIdx)) oldKeyToIdx = createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx);\n      // newStartVnode \u5728 odlChildren \u4e2d\u5bf9\u5e94\u7684 index\n      idxInOld = isDef(newStartVnode.key)\n        ? oldKeyToIdx[newStartVnode.key]\n        : findIdxInOld(newStartVnode, oldCh, oldStartIdx, oldEndIdx);\n      // \u6ca1\u6709key \u6216\u8005\u5728 old \u91cc\u9762\u6ca1\u627e\u5230\u8fd9\u4e2a key \u5c31\u521b\u5efa\u65b0\u8282\u70b9\n      if (isUndef(idxInOld)) {\n        // New element\n        createElm(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.elm, false, newCh, newStartIdx);\n      } else {\n        // \u83b7\u53d6\u540c index \u7684\u8001\u8282\u70b9\uff0c\u5982\u679c\u4e24\u4e2a\u8282\u70b9\u662f sameVnode \u5219\u8fdb\u884c patchVnode ,\u540c\u65f6\u6e05\u9664\u8001\u8282\u70b9\uff0c\u63d2\u5165\u65b0\u8282\u70b9\n        vnodeToMove = oldCh[idxInOld];\n        if (sameVnode(vnodeToMove, newStartVnode)) {\n          patchVnode(vnodeToMove, newStartVnode, insertedVnodeQueue, newCh, newStartIdx);\n          oldCh[idxInOld] = undefined;\n          canMove && nodeOps.insertBefore(parentElm, vnodeToMove.elm, oldStartVnode.elm);\n          // \u4e24\u4e2a\u8282\u70b9\u4e0d\u4e00\u6837\u5c31\u521b\u5efa\u65b0\u7684\n        } else {\n          // same key but different element. treat as new element\n          createElm(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.elm, false, newCh, newStartIdx);\n        }\n      }\n      newStartVnode = newCh[++newStartIdx];\n    }\n  }\n  // oldStartIdx > oldEndIdx \u8bf4\u660e\u8001\u8282\u70b9\u5df2\u7ecf\u904d\u5386\u5b8c\u4e86\uff0c\u65b0\u8282\u70b9\u6bd4\u8001\u8282\u70b9\u591a\uff0c\u591a\u51fa\u6765\u7684\u8282\u70b9\u52a0\u5165\u5230\u771f\u5b9e DOM \u4e2d\n  if (oldStartIdx > oldEndIdx) {\n    refElm = isUndef(newCh[newEndIdx + 1]) ? null : newCh[newEndIdx + 1].elm;\n    addVnodes(parentElm, refElm, newCh, newStartIdx, newEndIdx, insertedVnodeQueue);\n    // \u8fd9\u65f6\u65b0\u8282\u70b9\u904d\u5386\u5b8c\u4e86\uff0c\u8001\u8282\u70b9\u53ef\u80fd\u8fd8\u6ca1\u6709\uff0c\u76f4\u63a5\u628a\u8001\u8282\u70b9\u79fb\u9664\u5c31\u884c\u4e86\n  } else if (newStartIdx > newEndIdx) {\n    removeVnodes(oldCh, oldStartIdx, oldEndIdx);\n  }\n}\n")))),(0,o.kt)("h3",{id:"4-compiler-\u6a21\u5757"},"4. compiler \u6a21\u5757"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\u251c\u2500\u2500 codeframe.js\n\u251c\u2500\u2500 codegen\n\u2502   \u251c\u2500\u2500 events.js\n\u2502   \u2514\u2500\u2500 index.js\n\u251c\u2500\u2500 create-compiler.js\n\u251c\u2500\u2500 directives\n\u2502   \u251c\u2500\u2500 bind.js\n\u2502   \u251c\u2500\u2500 index.js\n\u2502   \u251c\u2500\u2500 model.js\n\u2502   \u2514\u2500\u2500 on.js\n\u251c\u2500\u2500 error-detector.js\n\u251c\u2500\u2500 helpers.js\n\u251c\u2500\u2500 index.js\n\u251c\u2500\u2500 optimizer.js\n\u251c\u2500\u2500 parser\n\u2502   \u251c\u2500\u2500 entity-decoder.js\n\u2502   \u251c\u2500\u2500 filter-parser.js\n\u2502   \u251c\u2500\u2500 html-parser.js\n\u2502   \u251c\u2500\u2500 index.js\n\u2502   \u2514\u2500\u2500 text-parser.js\n\u2514\u2500\u2500 to-function.js\n")),(0,o.kt)("h4",{id:"\u4ee3\u7801\u90e8\u5206-2"},"\u4ee3\u7801\u90e8\u5206"),(0,o.kt)("h5",{id:"1-codegenjs"},"1. codegen/","*",".js"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"index.js"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// \u5c06AST\u8bed\u6cd5\u6811\u8f6c\u6362\u6210 render \u53ca staticRenderFns \u5b57\u7b26\u4e32\nexport function generate(ast: ASTElement | void, options: CompilerOptions): CodegenResult {\n  const state = new CodegenState(options);\n  const code = ast ? genElement(ast, state) : '_c(\"div\")';\n  return {\n    render: `with(this){return ${code}}`,\n    staticRenderFns: state.staticRenderFns,\n  };\n}\n\n// \u8fd9\u4e24\u4e2a\u65b9\u6cd5\u7528\u6765\u5c06 AST \u8f6c\u6210 render \u51fd\u6570\u4e2d\u7684\u4e3b\u4f53\u5185\u5bb9\nexport function genElement(el: ASTElement, state: CodegenState): string {\n  // static\u3001v-once\u3001for\u3001if\u3001template\u3001slot\n}\nexport function genData(el: ASTElement, state: CodegenState): string {\n  // key\u3001ref\u3001refInFor\u3001pre\u3001component\u3001attr\u3001props\u3001events\u3001nativeEvents\u3001\n  // slotTarget\u3001scopedSlots\u3001model\u3001inline-template\u3001bind\u3001on\n}\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"events.js"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"\u5b9a\u4e49\u4e86\u517c\u5bb9\u7684 keyCodes \u548c keyNames\uff0c\u5e76\u5c06 \u6a21\u7248\u4e2d\u7684 vue \u4e8b\u4ef6\u6253\u5305\u8fdb render \u4e2d")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const keyCodes: { [key: string]: number | Array<number> } = {};\nconst keyNames: { [key: string]: string | Array<string> } = {};\nconst modifierCode: { [key: string]: string } = {};\n\n// \u8d1f\u8d23\u4e8b\u4ef6\u7ed1\u5b9a\u64cd\u4f5c\u7684\u5177\u4f53\u5b9e\u73b0\nexport function genHandlers(events: ASTElementHandlers, isNative: boolean): string {}\nfunction genHandler(handler: ASTElementHandler | Array<ASTElementHandler>): string {}\n")))),(0,o.kt)("h5",{id:"2-directivesjs"},"2. directives/","*",".js"),(0,o.kt)("p",null,"v-bind\u3001v-on\u3001v-model"),(0,o.kt)("h5",{id:"3-parserjs"},"3. parser/","*",".js"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"index.js")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"export const onRE = /^@|^v-on:/; /*\u5339\u914d@\u4ee5\u53cav-on\uff0c\u7ed1\u5b9a\u4e8b\u4ef6 */\nexport const dirRE = /^v-|^@|^:/; /*\u5339\u914dv-\u3001@\u4ee5\u53ca:*/\nexport const forAliasRE = /(.*?)\\s+(?:in|of)\\s+(.*)/; /*\u5339\u914dv-for\u4e2d\u7684in\u4ee5\u53caof*/\nexport const forIteratorRE =\n  /\\((\\{[^}]*\\}|[^,]*),([^,]*)(?:,([^,]*))?\\)/; /*v-for\u53c2\u6570\u4e2d\u5e26\u62ec\u53f7\u7684\u60c5\u51b5\u5339\u914d\uff0c\u6bd4\u5982(item, index)\u8fd9\u6837\u7684\u53c2\u6570*/\nconst argRE = /:(.*)$/; /* \u53d6\u53c2\u6570\u503c */\nconst bindRE = /^:|^v-bind:/; /*\u5339\u914dv-bind\u4ee5\u53ca:*/\nconst modifierRE = /\\.[^.]+/g; /*\u6839\u636e\u70b9\u6765\u5206\u5f00\u5404\u4e2a\u7ea7\u522b\u7684\u6b63\u5219\uff0c\u6bd4\u5982a.b.c.d\u89e3\u6790\u540e\u53ef\u4ee5\u5f97\u5230.b .c .d*/\n\n// HTML \u8f6c AST\nexport function parse(template: string, options: CompilerOptions): ASTElement | void {}\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"filter-parser.js")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// \u5faa\u73af exp ,\u89e3\u6790\u51fa\u6a21\u7248\u4e2d\u7684 expression \u548c filters\nexport function parseFilters(exp: string): string {}\n// filter \u51fd\u6570\u8f93\u51fa\u6210 render \u51fd\u6570\u60f3\u8981\u7684\u6837\u5b50\nfunction wrapFilter(exp: string, filter: string): string {}\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"text-parser.js")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// \u89e3\u6790\u5339\u914d {{}} \u4e2d\u7684\u53d8\u91cf --- defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g\n// {{}} \u662f\u9ed8\u8ba4\u7684\u5b57\u7b26\u4e32\u6a21\u7248\uff0c\u53ef\u5728\u521d\u59cb\u5316\u65f6\u81ea\u5b9a\u4e49\nexport function parseText(text: string, delimiters?: [string, string]): TextParseResult | void {}\n")),(0,o.kt)("p",null,"// todo"),(0,o.kt)("h2",{id:"3-vue-\u7ec4\u4ef6"},"3. Vue \u7ec4\u4ef6"),(0,o.kt)("h3",{id:"1-keep-alive"},"1. keep-alive"),(0,o.kt)("p",null,"keep-alive \u4e3b\u8981\u7528\u4e8e\u4fdd\u6301\u7ec4\u4ef6\u72b6\u6001\uff0c\u907f\u514d\u7ec4\u4ef6\u91cd\u590d\u521b\u5efa"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// \u66f4\u65b0 keep-alive \u4e2d\u7684 cache\nfunction pruneCache(keepAliveInstance: any, filter: Function) {}\n// \u6e05\u9664 cache \u6307\u5b9a key \u7684 vnode\nfunction pruneCacheEntry(cache: VNodeCache, key: string, keys: Array<string>, current?: VNode) {}\n\n// keep-alive \u7ec4\u4ef6\uff0c\u4e3b\u8981\u903b\u8f91\u5728 render \u51fd\u6570\u4e2d\n// --- 1. \u4f7f\u7528 getFirstComponentChild \u53d6\u51fa keep-alive \u7ec4\u4ef6\u4e0b\u9762\u7b2c\u4e00\u4e2a\u5b50\u7ec4\u4ef6\n// --- 2. \u767d\u9ed1\u540d\u5355\u6821\u9a8c\uff0c\u770b\u662f\u5426\u662f\u4f1a\u88ab\u7f13\u5b58\u7684\u7ec4\u4ef6\n// --- 3. \u5b50\u7ec4\u4ef6\u5728 cache \u4e2d\uff0c\u5c31\u76f4\u63a5\u53d6\u51fa\u8fd4\u56de vnode\uff0c\u4e0d\u5728 vnode\u4e2d\uff0c\u5c31\u5b58\u5165 vnode,\u5e76\u6821\u9a8c\u6700\u5927\u7f13\u5b58\u6570\nexport default {\n  name: 'keep-alive',\n  abstract: true,\n  props: {\n    include: patternTypes, // \u7f13\u5b58\u767d\u540d\u5355\n    exclude: patternTypes, // \u7f13\u5b58\u9ed1\u540d\u5355\n    max: [String, Number], // \u7f13\u5b58\u5b9e\u4f8b\u4e0a\u9650\n  },\n  render() {\n    const slot = this.$slots.default;\n    const vnode: VNode = getFirstComponentChild(slot); // \u627e\u5230\u7b2c\u4e00\u4e2a\u5b50\u7ec4\u4ef6\u5bf9\u8c61\n    const componentOptions: ?VNodeComponentOptions = vnode && vnode.componentOptions;\n    if (componentOptions) {\n      // check pattern\n      const name: ?string = getComponentName(componentOptions);\n      const { include, exclude } = this;\n      if ((include && (!name || !matches(include, name))) || (exclude && name && matches(exclude, name))) {\n        return vnode;\n      }\n\n      const { cache, keys } = this;\n      const key: ?string =\n        vnode.key == null\n          ? componentOptions.Ctor.cid + (componentOptions.tag ? `::${componentOptions.tag}` : '')\n          : vnode.key;\n      if (cache[key]) {\n        vnode.componentInstance = cache[key].componentInstance;\n        remove(keys, key);\n        keys.push(key);\n      } else {\n        cache[key] = vnode;\n        keys.push(key);\n        if (this.max && keys.length > parseInt(this.max)) {\n          pruneCacheEntry(cache, keys[0], keys, this._vnode);\n        }\n      }\n      vnode.data.keepAlive = true;\n    }\n    return vnode || (slot && slot[0]);\n  },\n};\n")),(0,o.kt)("h2",{id:"4-vue-\u5de5\u5177\u51fd\u6570"},"4. Vue \u5de5\u5177\u51fd\u6570"),(0,o.kt)("h3",{id:"1-nexttick"},"1. nextTick()"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"let timerFunc;\nif (typeof Promise !== 'undefined' && isNative(Promise)) {\n  const p = Promise.resolve();\n  timerFunc = () => {\n    p.then(flushCallbacks);\n    if (isIOS) setTimeout(noop);\n  };\n  isUsingMicroTask = true;\n} else if (\n  !isIE &&\n  typeof MutationObserver !== 'undefined' &&\n  (isNative(MutationObserver) || MutationObserver.toString() === '[object MutationObserverConstructor]')\n) {\n  let counter = 1;\n  const observer = new MutationObserver(flushCallbacks);\n  const textNode = document.createTextNode(String(counter));\n  observer.observe(textNode, {\n    characterData: true,\n  });\n  timerFunc = () => {\n    counter = (counter + 1) % 2;\n    textNode.data = String(counter);\n  };\n  isUsingMicroTask = true;\n} else if (typeof setImmediate !== 'undefined' && isNative(setImmediate)) {\n  timerFunc = () => {\n    setImmediate(flushCallbacks);\n  };\n} else {\n  timerFunc = () => {\n    setTimeout(flushCallbacks, 0);\n  };\n}\n")),(0,o.kt)("h2",{id:"vue-\u6e90\u7801\u76ee\u5f55"},"Vue \u6e90\u7801\u76ee\u5f55"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"dist"),(0,o.kt)("br",null)),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"esm"),"\uff1aes \u89c4\u8303\uff0c",(0,o.kt)("strong",{parentName:"li"},"common"),"\uff1acommonjs \u89c4\u8303\uff0c",(0,o.kt)("strong",{parentName:"li"},"browsers"),"\uff1a\u7528\u4e8e\u6d4f\u89c8\u5668\u7684\uff0c ",(0,o.kt)("strong",{parentName:"li"},"\u5176\u5b83"),"\uff1aUMD \u89c4\u8303"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"runtime"),"\uff1a")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"\u251c\u2500\u2500 dist\n\u2502\xa0\xa0 \u251c\u2500\u2500 README.md\n\u2502\xa0\xa0 \u251c\u2500\u2500 vue.common.dev.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 vue.common.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 vue.common.prod.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 vue.esm.browser.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 vue.esm.browser.min.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 vue.esm.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 vue.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 vue.min.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 vue.runtime.common.dev.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 vue.runtime.common.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 vue.runtime.common.prod.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 vue.runtime.esm.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 vue.runtime.js\n\u2502\xa0\xa0 \u2514\u2500\u2500 vue.runtime.min.js\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"src"),"\uff1aVue \u6e90\u4ee3\u7801\u6838\u5fc3\u76ee\u5f55"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"src\n\u251c\u2500\u2500 compiler                            # \u7f16\u8bd1\u6a21\u7248\n\u2502\xa0\xa0 \u251c\u2500\u2500 codeframe.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 codegen\n\u2502\xa0\xa0 \u251c\u2500\u2500 create-compiler.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 directives\n\u2502\xa0\xa0 \u251c\u2500\u2500 error-detector.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 helpers.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 index.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 optimizer.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 parser\n\u2502\xa0\xa0 \u2514\u2500\u2500 to-function.js\n\u251c\u2500\u2500 core                                # \u662fVue\u7684\u6838\u5fc3\n\u2502\xa0\xa0 \u251c\u2500\u2500 components                      # keep-alive\n\u2502\xa0\xa0 \u251c\u2500\u2500 global-api                      # \u5168\u5c40api  .use  .mixin  .extend\n\u2502\xa0\xa0 \u251c\u2500\u2500 instance                        # \u751f\u547d\u5468\u671f\n\u2502\xa0\xa0 \u251c\u2500\u2500 observer                        # \u53cc\u5411\u6570\u636e\u7ed1\u5b9a\u903b\u8f91\n\u2502\xa0\xa0 \u251c\u2500\u2500 util                            #\n\u2502\xa0\xa0 \u2514\u2500\u2500 vdom                            # \u865a\u62dfdom\u6784\u5efa\u3001\u6bd4\u8f83\u7b49\n\u251c\u2500\u2500 platforms                           # \u8de8\u5e73\u53f0\u7684vue\u4ee3\u7801\n\u2502\xa0\xa0 \u251c\u2500\u2500 web\n\u2502\xa0\xa0 \u2514\u2500\u2500 weex\n\u251c\u2500\u2500 server                              # \u5904\u7406\u670d\u52a1\u5668\u6e32\u67d3\u7684\n\u2502\xa0\xa0 \u251c\u2500\u2500 bundle-renderer\n\u2502\xa0\xa0 \u251c\u2500\u2500 create-basic-renderer.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 create-renderer.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 optimizing-compiler\n\u2502\xa0\xa0 \u251c\u2500\u2500 render-context.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 render-stream.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 render.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 template-renderer\n\u2502\xa0\xa0 \u251c\u2500\u2500 util.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 webpack-plugin\n\u2502\xa0\xa0 \u2514\u2500\u2500 write.js\n\u251c\u2500\u2500 sfc                                 # \u5904\u7406 .vue \u6587\u4ef6\n\u2502\xa0\xa0 \u2514\u2500\u2500 parser.js\n\u2514\u2500\u2500 shared                              # \u63d0\u4f9b\u5230\u5168\u5c40\u7684\u5de5\u5177\u51fd\u6570\n   \u251c\u2500\u2500 constants.js\n   \u2514\u2500\u2500 util.js\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"benchmarks"),"\uff1aVue \u7528\u6765\u505a\u8dd1\u5206\u7528\u7684\uff0c\u5c55\u793a Vue \u5728 svg\u3001big table\u3001uptime \u65f6\u7684\u9875\u9762\u6027\u80fd")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"examples"),"\uff1aVue \u4f7f\u7528\u7684 hello world")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"flow"),"\uff1aflow.js \u662f\u4e00\u4e2a js \u5e93\uff0c\u4f5c\u9759\u6001\u7c7b\u578b\u68c0")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"packages"),"\uff1a\u5355\u72ec\u6253\u51fa\u6765\u7684\u4e00\u4e9b\u5305")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"scripts"),"\uff1a\u5b58\u653e\u53ef\u6267\u884c\u7684\u811a\u672c\uff0c\u7528\u6765\u6253\u5305\u9879\u76ee")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"test"),"\uff1a\u6d4b\u8bd5\u6587\u4ef6\u76ee\u5f55")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"types"),"\uff1a\u4e00\u4e9b\u57fa\u672c\u7684 ts \u89c4\u5219\u6821\u9a8c"))),(0,o.kt)("h4",{id:"\u535a\u6587\u53c2\u8003"},"\u535a\u6587\u53c2\u8003"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"http://zhouweicsu.github.io/blog/2017/03/07/vue-2-0-reactivity/"},"Vue2.0 \u6e90\u7801\u9605\u8bfb\uff1a\u54cd\u5e94\u5f0f\u539f\u7406")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/answershuto/learnVue"},"learnVue --- vue \u5168\u5bb6\u6876\u6e90\u7801\u89e3\u6790")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://template-explorer.vuejs.org/"},"Vue2.x \u5728\u7ebf\u7f16\u8bd1")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/answershuto/learnVue/blob/master/docs/VirtualDOM%E4%B8%8Ediff(Vue%E5%AE%9E%E7%8E%B0).MarkDown"},"VirtualDOM \u4e0e diff(Vue \u5b9e\u73b0).MarkDown"))))}u.isMDXComponent=!0},7889:function(e,n,t){n.Z=t.p+"assets/images/vue-dependency-774ae6d402dede74129297ef8a1e3b36.jpg"},5757:function(e,n,t){n.Z=t.p+"assets/images/vue-reactive-d7fb3ab5d3349adf12081bf2f26d46e8.jpg"}}]);