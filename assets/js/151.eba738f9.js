(window.webpackJsonp=window.webpackJsonp||[]).push([[151],{398:function(t,e,a){"use strict";a.r(e);var l=a(28),r=Object(l.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"nginx-rewrite"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-rewrite"}},[t._v("#")]),t._v(" Nginx --- rewrite")]),t._v(" "),a("h2",{attrs:{id:"module-rewrite-的指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#module-rewrite-的指令"}},[t._v("#")]),t._v(" module rewrite 的指令")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("directive")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("scope of use")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("desc")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("break")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("server, location, if")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("if ( condition ){}")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("server, location")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("return")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("server, location, if")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("rewrite")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("server, location, if")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("rewrite_log   on\\off")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("http, server, location, if")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("set $variable value")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("server, location, if")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("uninitialized_variable_warn on\\off")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("http, server, location, if")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("控制是否记录有关未初始化变量的警告")])])])]),t._v(" "),a("h2",{attrs:{id:"_1-rewrite-指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-rewrite-指令"}},[t._v("#")]),t._v(" 1. rewrite 指令")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rewrite")]),t._v(" regex replacement "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("flag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("ul",[a("li",[t._v("如果正则表达式包含“}”或“;”字符，整个表达式应用单引号或双引号引起来")]),t._v(" "),a("li",[t._v("当 replacement 是以"),a("code",[t._v("http://")]),t._v(" "),a("code",[t._v("https://")]),t._v(" "),a("code",[t._v("$scheme")]),t._v("开头时，处理停止，直接重定向一个 302")]),t._v(" "),a("li",[t._v("如果替换字符串包括新的请求参数，则先前的请求参数将附加在它们之后")])]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rewrite")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("users"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("show"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("$"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" last"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"_1-1-flag"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-flag"}},[t._v("#")]),t._v(" 1.1 flag")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("flag")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("url change or not")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("desc")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("last")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("no")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("停止处理当前的 ngx_http_rewrite_module 指令集，并开始搜索与更改后的 URI 相匹配的新位置；")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("break")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("no")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("与 break 指令一样，停止处理当前的 ngx_http_rewrite_module 指令集；")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("redirect")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("yes")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("返回带有 302 代码的临时重定向；如果替换字符串不是以“ http：//”，“ https：//”或“ $ scheme”开头，则使用该字符串；")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("permanent")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("yes")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("返回带有 301 代码的永久重定向")])])])]),t._v(" "),a("ul",[a("li",[t._v("break 与 last 都能阻止后续的 rewrite 指令执行，但是 last 如果在 location 下的话，对于重写的 URI 会重新匹配 location,但 break 不会\n"),a("ul",[a("li",[t._v("last： 停止当前这个请求，并根据 rewrite 匹配的规则重新发起一个请求。新请求又从第一阶段开始执行…")]),t._v(" "),a("li",[t._v("break：相对 last，break 并不会重新发起一个请求，只是跳过当前的 rewrite 阶段，并执行本请求后续的执行阶段")])])])]),t._v(" "),a("h2",{attrs:{id:"_2-if-指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-if-指令"}},[t._v("#")]),t._v(" 2. if 指令")]),t._v(" "),a("ul",[a("li",[t._v('如果变量 $variable 的值为空字符串或者字符串"0"，则为 false\n'),a("ul",[a("li",[t._v("版本 "),a("code",[t._v("1.0.1")]),t._v(' 之前，任何以"0"开始的字符串都会计算成 false')])])]),t._v(" "),a("li",[t._v("变量与一个字符串的比较 相等为"),a("code",[t._v("=")]),t._v(" 不相等为"),a("code",[t._v("!=")]),t._v(" "),a("strong",[t._v("此处与赋值语句有区别的")])]),t._v(" "),a("li",[t._v("变量与一个正则表达式的模式匹配 操作符可以是("),a("code",[t._v("~")]),t._v(" 区分大小写的正则匹配， "),a("code",[t._v("~*")]),t._v("不区分大小写的正则匹配， "),a("code",[t._v("!~")]),t._v(" "),a("code",[t._v("!~*")]),t._v("，前面两者的非)")]),t._v(" "),a("li",[t._v("检测文件是否存在 使用 "),a("code",[t._v("-f")]),t._v("(存在) 和 "),a("code",[t._v("!-f")]),t._v("(不存在)")]),t._v(" "),a("li",[t._v("检测路径是否存在 使用 "),a("code",[t._v("-d")]),t._v("(存在) 和 "),a("code",[t._v("!-d")]),t._v("(不存在) 后面判断可以是字符串也可是变量")]),t._v(" "),a("li",[t._v("检测文件、路径、或者链接文件是否存在 使用 "),a("code",[t._v("-e")]),t._v("(存在) 和 "),a("code",[t._v("!-e")]),t._v("(不存在) 后面判断可以是字符串也可是变量")]),t._v(" "),a("li",[t._v("检测文件是否为可执行文件 使用 "),a("code",[t._v("-x")]),t._v("(可执行) 和 "),a("code",[t._v("!-x")]),t._v("(不可执行) 后面判断可以是字符串也可是变量")])]),t._v(" "),a("h2",{attrs:{id:"_3-return-指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-return-指令"}},[t._v("#")]),t._v(" 3. return 指令")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("return code [text];\nreturn code URL;\nreturn URL;\n")])])]),a("p",[a("a",{attrs:{href:"http://nginx.org/en/docs/http/ngx_http_rewrite_module.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方 rewrite 模块"),a("OutboundLink")],1)])])}),[],!1,null,null,null);e.default=r.exports}}]);