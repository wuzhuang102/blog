(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{294:function(t,a,s){"use strict";s.r(a);var e=s(28),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("http缓存分两种 "),s("code",[t._v("强缓存")]),t._v(" 与 "),s("code",[t._v("协商缓存")]),t._v("，主要作用是加快资源获取速度，提升用户体验，减少网络传输、降低服务器压力。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/http/http-cache.jpg",alt:"http-cache"}})]),t._v(" "),s("h2",{attrs:{id:"强存缓"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#强存缓"}},[t._v("#")]),t._v(" 强存缓")]),t._v(" "),s("p",[t._v("不需要发送请求到服务器，直接读取浏览器本地缓存，chrome中状态码为200；chrome中内存又分为Disk Cache 和 Memory Cache，存放的位置由浏览器控制，由"),s("code",[t._v("Expires")]),t._v(" "),s("code",[t._v("Cache-Control")]),t._v(" "),s("code",[t._v("Pragma")]),t._v(" 3个Header来控制")]),t._v(" "),s("h3",{attrs:{id:"expires"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#expires"}},[t._v("#")]),t._v(" Expires")]),t._v(" "),s("p",[t._v("Expires 是一个日期，浏览器发起请求时，会根据系统时间和Expires的值进行比较，超过了则缓存失效。由于计算机时间不准确的原因可能导致缓存失效， Expires 在三个中优先级最低。")]),t._v(" "),s("h3",{attrs:{id:"cache-control"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cache-control"}},[t._v("#")]),t._v(" Cache-Control")]),t._v(" "),s("p",[t._v("请求头和响应头中都可以使用")]),t._v(" "),s("ul",[s("li",[t._v("max-age: 单位秒，缓存的时间计算方式是距离发起的时间的秒数，超过间隔的秒数缓存失效")]),t._v(" "),s("li",[t._v("no-cache: 不使用缓存，需要与服务器验证缓存是否新鲜")]),t._v(" "),s("li",[t._v("no-store: 禁止使用缓存（包括协商缓存），每次都重新请求新资源")]),t._v(" "),s("li",[t._v("private: 专用于个人的缓存，中间代理、CDN不能缓存此响应")]),t._v(" "),s("li",[t._v("public: 响应可以被中间代理、CDN缓存")]),t._v(" "),s("li",[t._v("must-revalidate: 缓存过期前可以使用，过期后必须向服务器验证")])]),t._v(" "),s("h3",{attrs:{id:"pragma"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pragma"}},[t._v("#")]),t._v(" pragma")]),t._v(" "),s("p",[t._v("只有一个属性值，就是no-cache,效果与Cache-Control中的no-cache一致，不使用强缓存，需要与服务器验证缓存是否新鲜，优先级最高")]),t._v(" "),s("h2",{attrs:{id:"协商缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#协商缓存"}},[t._v("#")]),t._v(" 协商缓存")]),t._v(" "),s("p",[t._v("当浏览器的强缓存失效或者不走强缓存的时候，并且在请求头中设置可If-Modified-Since 或者 If-None-Match 的时候，会将这两个属性值到服务器去验证是否命中了协商缓存，如果命中，返回304，加载浏览器缓存，并且响应头会设置Last-Modified 或者 Etag。")]),t._v(" "),s("ul",[s("li",[t._v("Etag 优先级 高于 Last-Modified")])]),t._v(" "),s("h3",{attrs:{id:"etag-if-none-match"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#etag-if-none-match"}},[t._v("#")]),t._v(" Etag/If-None-Match")]),t._v(" "),s("p",[t._v("ETag 为 response header,  If-None-Match 为 request header")]),t._v(" "),s("p",[t._v('ETag/If-None-Match 的值是一串 hash 码，代表的是一个资源的标识符，当服务端的文件变化的时候，它的 hash码会随之改变，通过请求头中的 If-None-Match 和当前文件的 hash 值进行比较，如果相等则表示命中协商缓存。ETag 又有强弱校验之分，如果 hash 码是以 "W/" 开头的一串字符串，说明此时协商缓存的校验是弱校验的，只有服务器上的文件差异（根据 ETag 计算方式来决定）达到能够触发 hash 值后缀变化的时候，才会真正地请求资源，否则返回 304 并加载浏览器缓存。')]),t._v(" "),s("h3",{attrs:{id:"last-modified-if-modified-since"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#last-modified-if-modified-since"}},[t._v("#")]),t._v(" Last-Modified/If-Modified-Since")]),t._v(" "),s("p",[t._v("Last-Modified为response header, If-Modified-Since 为 request header")]),t._v(" "),s("p",[t._v("Last-Modified/If-Modified-Since 的值代表的是文件的最后修改时间，第一次请求服务端会把资源的最后修改时间放到 Last-Modified 响应头中，第二次发起请求的时候，请求头会带上上一次响应头中的 Last-Modified 的时间，并放到 If-Modified-Since 请求头属性中，服务端根据文件最后一次修改时间和 If-Modified-Since 的值进行比较，如果相等，返回 304 ，并加载浏览器缓存。")]),t._v(" "),s("ul",[s("li",[t._v("如果文件的修改频率在秒级以下，Last-Modified/If-Modified-Since 会错误地返回 304")]),t._v(" "),s("li",[t._v("如果文件被修改了，但是内容没有任何变化的时候，Last-Modified/If-Modified-Since 会错误地返回 304")])]),t._v(" "),s("h2",{attrs:{id:"文件位置-size"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#文件位置-size"}},[t._v("#")]),t._v(" 文件位置 size")]),t._v(" "),s("ol",[s("li",[t._v("资源的大小           ---- 状态 200  或者304（协商缓存)")]),t._v(" "),s("li",[t._v("from disk cache      ----- 状态码200")]),t._v(" "),s("li",[t._v("from memory cache    ----- 可执行文件，已写入内存，关闭窗口，缓存失效")]),t._v(" "),s("li",[t._v("from ServiceWorker  ----- 表示此资源是取自 from ServiceWorker")])]),t._v(" "),s("h2",{attrs:{id:"刷新机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#刷新机制"}},[t._v("#")]),t._v(" 刷新机制")]),t._v(" "),s("ol",[s("li",[t._v("浏览器输入地址,会使用强缓存与协商缓存  是最快的")]),t._v(" "),s("li",[t._v("点击刷新，chrome使用强缓存与协商缓存，firefox跳过强缓存，只使用协商缓存，不同浏览器实现不一样")]),t._v(" "),s("li",[t._v("hard reload, 删除本地缓存，全部请求新的服务器数据")])]),t._v(" "),s("h2",{attrs:{id:"缓存为坑位"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#缓存为坑位"}},[t._v("#")]),t._v(" 缓存为坑位")]),t._v(" "),s("h3",{attrs:{id:"单页应用微信缓存问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#单页应用微信缓存问题"}},[t._v("#")]),t._v(" 单页应用微信缓存问题")]),t._v(" "),s("p",[t._v("微信浏览器在未明确配置缓存策略时，使用的是强缓存策略，导致入口文件不更新，html的meta 缓存策略也是失效的")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://cloud.tencent.com/developer/article/1353428",target:"_blank",rel:"noopener noreferrer"}},[t._v("单页应用微信缓存博文"),s("OutboundLink")],1)]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 单页应用 入口文件 禁止缓存")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("mnt"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dat1"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("test"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("tes"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("htm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try_files")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#### kill cache")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" Last"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Modified "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$date_gmt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" Cache"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if_modified_since")]),t._v(" off"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("expires")]),t._v(" off"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    etag off"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\\"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("jpg"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("jpeg"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("gif"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("png"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("ico"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("css"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("js"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("mnt"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dat1"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("test"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("tes"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("access_log")]),t._v(" off"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("expires")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("d"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("a",{attrs:{href:"https://juejin.im/post/5eb7f811f265da7bbc7cc5bd#comment",target:"_blank",rel:"noopener noreferrer"}},[t._v("博文来源"),s("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=r.exports}}]);